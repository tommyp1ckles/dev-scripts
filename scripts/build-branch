#!/bin/bash

branch=$(git branch --show-current)

function ctrl_c() {
	echo "[Info] ðŸ’€ CTRL-C ... Reverting branch!!!"
	git checkout ${branch}
	exit 0
}

trap ctrl_c INT

for hash in $(git log --format="%H" ${branch}...main); do
	msg=$(git show ${hash} --format=%s --no-patch)
	printf "[Info] ðŸ—ï¸ Commit: ${msg} =>\t${hash}\n"
	git checkout ${hash} 
	echo "[Info] ðŸ—ï¸ Building ${hash}\n"
	make dev-docker-image 2>/dev/null >/dev/null
	if [[ $? == 0 ]]; then
		echo "[Info] âœ… OK âœ… ${hash}"
	else
		echo "[Error] âŒ Failed to build âŒ ${msg} => ${hash}"
		git checkout $branch
		exit 1
	fi
done

git checkout $branch
echo "[Info] âœ…âœ…âœ…âœ… All commits on branch ${branch} succeeded !!! âœ…âœ…âœ…âœ…"

